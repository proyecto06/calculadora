<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimador de Consumo El√©ctrico Pro</title>

    <!-- Librer√≠as externas -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">

    <!-- Hojas de estilo -->
    <link rel="stylesheet" href="styles.css">

    <!-- PWA Manifest & Theme -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
</head>
<body>

    <!-- Contenedor del formulario de inicio de sesi√≥n -->
    <div id="login-container">
        <div class="login-box">
            <h2>Inicio de Sesi√≥n</h2>
            <form id="login-form">
                <div class="input-group">
                    <label for="username">Usuario:</label>
                    <input type="text" id="username" name="username" required autocapitalize="off" autocorrect="off" spellcheck="false" autocomplete="username">
                </div>
                <div class="input-group">
                    <label for="password">Contrase√±a:</label>
                    <input type="password" id="password" name="password" required autocapitalize="off" autocorrect="off" spellcheck="false" autocomplete="current-password">
                </div>
                <button type="submit">Entrar</button>
                <button type="button" id="reset-users" class="btn-link">Restablecer usuarios</button>
                <div id="error-message" class="error-message" role="alert" aria-live="polite"></div>
            </form>
        </div>
    </div>

    <!-- Contenedor de la aplicaci√≥n principal -->
    <div id="app-container" style="display: none;">
        <div class="top-bar">
            <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                <div class="pestanas">
                    <button class="pestana-btn active" data-pestana="consumo">Censo</button>
                    <button class="pestana-btn" data-pestana="corrientes">Medici√≥n</button>
                    <button class="pestana-btn" data-pestana="lecturas">Lecturas</button>
                </div>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div id="usuario-activo" class="usuario-activo"></div>
                    <div class="dropdown-menu-container">
                        <button class="dropdown-toggle-btn" id="user-menu-toggle">
                            Men√∫ <span class="arrow-down">&#9660;</span>
                        </button>
                        <div class="dropdown-content" id="user-dropdown-content">
                            <a href="#" id="install-app-btn" style="display: none;">üì≤ Instalar App</a>
                            <a href="#" id="menu-artefactos">Artefactos</a>
                            <a href="#" id="settings-btn" data-pestana="configuracion">Configuraci√≥n</a>
                            <a href="#" id="logout-btn" style="color: #dc3545;">Cerrar Sesi√≥n</a>
                        </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        
                                <!-- ========= CONTENIDO PESTA√ëA CONSUMO ========= -->
                                <div id="consumo" class="contenido-pestana active">
                                    <h1>Censo de Carga</h1>
                        
                                    <div class="grupo-input">
                                        <div style="flex-grow: 1;">
                                            <input id="lista-aparatos" placeholder="Buscar dispositivos..." style="width: 100%; padding: 8px;">
                                        </div>
                                    </div>
                        
                                    <div class="grupo-input" style="justify-content: flex-start; margin-top: 15px;">
                                        <button id="boton-calcular" class="oculto">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/></svg>
                                            Calcular Total
                                        </button>
                                        <button id="boton-limpiar" style="background: #dc3545; display: none;">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>
                                            Limpiar Todo
                                        </button>
                                        <button id="exportar-pdf" class="btn-exportar oculto" title="Exportar a PDF">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                                                <path d="M4.603 14.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.697 19.697 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.188-.012.396-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.066.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.712 5.712 0 0 1-.911-.95 11.651 11.651 0 0 0-1.997.406 11.307 11.307 0 0 1-1.02 1.51c-.292.35-.609.656-.927.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.545-.094.148-.096.35.04.535.071.096.163.15.266.15.114 0 .237-.06.376-.192.14-.132.32-.374.425-.765.105-.388.087-.663 0-.511z"/>
                                            </svg>
                                            Exportar PDF
                                        </button>
                                    </div>
                        
                                    <div id="items-seleccionados" style="margin: 20px 0;"></div>
                                    <div id="resultado" aria-live="polite"></div>
                                </div>
                        
                                <!-- ========= CONTENIDO PESTA√ëA CORRIENTES ========= -->
                                <div id="corrientes" class="contenido-pestana">
                                    <h1>C√°lculo por Medici√≥n</h1>
                        
                                    <div class="grupo-input">
                                        <div>
                                            <label for="voltaje-r">Voltaje R (V):</label>
                                            <input type="number" id="voltaje-r" class="input-config" value="120">
                                        </div>
                        
                                        <div>
                                            <label for="voltaje-s">Voltaje S (V):</label>
                                            <input type="number" id="voltaje-s" class="input-config" value="120">
                                        </div>
                        
                                        <div>
                                            <label for="voltaje-t">Voltaje T (V):</label>
                                            <input type="number" id="voltaje-t" class="input-config" value="120">
                                        </div>
                                    </div>
                        
                                    <div class="grupo-input">
                                        <div>
                                            <label for="corriente-r">Corriente R (A):</label>
                                            <input type="number" id="corriente-r" class="input-config">
                                        </div>
                        
                                        <div>
                                            <label for="corriente-s">Corriente S (A):</label>
                                            <input type="number" id="corriente-s" class="input-config">
                                        </div>
                        
                                        <div>
                                            <label for="corriente-t">Corriente T (A):</label>
                                            <input type="number" id="corriente-t" class="input-config">
                                        </div>
                                    </div>
                        
                                    <div class="grupo-input">
                                        <div style="flex-grow:1;">
                                            <p class="info">Los par√°metros "Horas Mensuales", "D√≠as por Mes" y los costos (kWh, kVA) se toman de la secci√≥n "Configuraci√≥n General".</p>
                                        </div>
                                    </div>
                        
                                    <div class="grupo-input" style="justify-content: flex-start; margin-top: 15px;">
                                        <button id="boton-calcular-corrientes">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/></svg>
                                            Calcular Medici√≥n
                                        </button>
                                        <button id="boton-limpiar-corrientes" style="background: #dc3545; display: none;">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>
                                            Limpiar Campos
                                        </button>
                                    </div>
                        
                                    <div id="resultado-corrientes" class="oculto" aria-live="polite"></div>
                                </div>
                        
                                <!-- ========= CONTENIDO PESTA√ëA LECTURAS ========= -->
                                <div id="lecturas" class="contenido-pestana">
                                    <h1>Control de Lecturas</h1>
                        
                                    <div class="lect-tabs">
                                        <div class="lect-tab-buttons">
                                            <button class="lect-tab-btn active" data-tab="fecha-instalacion">Por Medidor</button>
                                            <button class="lect-tab-btn" data-tab="ctc">Por Capacidad</button>
                                        </div>
                                    </div>
                        
                                    <div id="formulario-fecha-instalacion" class="lect-tab-content">
                                        <div class="grupo-input">
                                            <div>
                                                <label for="fecha-instalacion">Fecha de Inicio:</label>
                                                <input type="date" id="fecha-instalacion" class="input-config" aria-describedby="fecha-instalacion-error">
                                                <small id="fecha-instalacion-error" class="error-message-inline" aria-live="polite"></small>
                                            </div>
                                            <div>
                                                <label for="fecha-actual">Fecha Actual:</label>
                                                <input type="date" id="fecha-actual" class="input-config" value="" aria-describedby="fecha-actual-error">
                                                <small id="fecha-actual-error" class="error-message-inline" aria-live="polite"></small>
                                            </div>
                                            <div>
                                                <label for="lectura-instalacion">Lectura de Inicio:</label>
                                                <input type="number" id="lectura-instalacion" class="input-config">
                                            </div>
                                            <div>
                                                <label for="lectura-contador">Lectura Actual:</label>
                                                <input type="number" id="lectura-contador" class="input-config">
                                            </div>
                                            <div>
                                                <label for="multiplicador-lectura">Multiplicador:</label>
                                                <input type="number" id="multiplicador-lectura" class="input-config" value="1" step="any">
                                            </div>
                                        </div>
                                        <div class="grupo-input" style="justify-content: flex-start; margin-top: 15px;">
                                            <button id="calcular-fecha-instalacion">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/></svg>
                                                Calcular Lectura
                                            </button>
                                        </div>
                                    </div>
                        
                                    <div id="formulario-ctc" class="lect-tab-content">
                                        <div class="grupo-input" style="align-items: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px;">
                                            <label style="min-width: auto; margin-right: 15px;">Tipo de Entrada:</label>
                                            <div>
                                                <input type="radio" id="tipo-entrada-ctc" name="tipo-entrada-capacidad" value="ctc" checked>
                                                <label for="tipo-entrada-ctc" style="min-width: auto; font-weight: normal; margin-right: 10px; cursor: pointer;">Ingresar CTC (Carga Total Conectada)</label>
                                            </div>
                                            <div>
                                                <input type="radio" id="tipo-entrada-cti" name="tipo-entrada-capacidad" value="cti">
                                                <label for="tipo-entrada-cti" style="min-width: auto; font-weight: normal; cursor: pointer;">Ingresar CTI (Capacidad Total Instalada)</label>
                                            </div>
                                        </div>
                                        <div class="grupo-input" style="align-items: flex-end;">
                                            <div>
                                                <label for="ctc-input" id="label-ctc-input">CTC (kVA):</label>
                                                <input type="number" id="ctc-input" class="input-config">
                                            </div>
                                            <div id="contenedor-check-trifasico" style="display: flex; align-items: center; padding-bottom: 8px; margin-left: 15px;">
                                                <input type="checkbox" id="check-trifasico" class="input-config" style="width: auto; margin-right: 8px; cursor: pointer;">
                                                <label for="check-trifasico" style="min-width: auto; font-weight: normal; cursor: pointer;">¬øEs Trif√°sico?</label>
                                            </div>
                                        </div>
                                        <div class="grupo-input" style="justify-content: flex-start; margin-top: 15px;">
                                            <button id="calcular-ctc">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/></svg>
                                                Calcular Proyecci√≥n
                                            </button>
                                        </div>
                                    </div>
                        
                                    <div class="grupo-input" style="justify-content: flex-start; margin-top: 15px;">
                                        <button id="boton-limpiar-lecturas" style="background: #dc3545; display: none;">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>
                                            Limpiar Todo
                                        </button>
                                    </div>
                        
                                    <div id="resultado-lecturas" style="margin-top: 20px;" aria-live="polite"></div>
                                </div>
                        
                                <!-- ========= CONTENIDO PESTA√ëA CONFIGURACI√ìN ========= -->
                                <div id="configuracion" class="contenido-pestana">
                                    <h1>Configuraci√≥n General</h1>
                        
                                    <div class="grupo-input">
                                        <div>
                                            <label for="horas-mes-config">Horas Mensuales:</label>
                                            <input type="number" id="horas-mes-config" value="300" class="input-config">
                                        </div>
                        
                                        <div>
                                            <label for="dias-mes-config">D√≠as por Mes:</label>
                                            <input type="number" id="dias-mes-config" value="30" class="input-config">
                                        </div>
                        
                                        <div>
                                            <label for="costo-kva-config">Costo kVA ($):</label>
                                            <input type="number" id="costo-kva-config" value="1.30" step="0.01" class="input-config">
                                        </div>
                        
                                        <div>
                                            <label for="iva-porcentaje-config">IVA (%):</label>
                                            <input type="number" id="iva-porcentaje-config" value="16" step="0.1" class="input-config">
                                        </div>
                        
                                        <div>
                                            <label for="valor-dolar-config">Tipo de cambio ($ a Bs):</label>
                                            <input type="number" id="valor-dolar-config" value="65" step="0.1" class="input-config">
                                        </div>
                        
                                        <div>
                                            <label for="costo-kwh-config">Costo kWh ($):</label>
                                            <input type="number" id="costo-kwh-config" value="0.01" step="0.01" class="input-config">
                                        </div>
                                    </div>
                        

                        
                                    <div class="grupo-input" style="justify-content: flex-start; margin-top: 15px;">
                                        <button id="guardar-configuracion"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path fill-rule="evenodd" d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg> Guardar Configuraci√≥n</button>
                                    </div>
                                    <div id="mensaje-configuracion" style="margin-top: 15px; font-weight: bold;" aria-live="polite"></div>
                        
                                    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
                                    <div class="data-management-section">
                                        <h3>Gesti√≥n de Datos (Local y Nube)</h3>
                                        <div class="data-buttons-grid">
                                            <button id="btn-exportar-datos">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>
                                                JSON Local
                                            </button>
                                            
                                            <label for="import-file-input" id="label-import-file" class="btn-importar">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path fill-rule="evenodd" d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>
                                                Importar
                                            </label>
                                            
                                            <button id="btn-cloud-upload">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"/><path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/></svg>
                                                ‚òÅ Subir a Nube
                                            </button>
                                            
                                            <button id="btn-cloud-download">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646 10.854a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 9.293V5.5a.5.5 0 0 0-1 0v3.793L6.354 8.146a.5.5 0 1 0-.708.708l2 2z"/><path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/></svg>
                                                ‚òÅ Bajar de Nube
                                            </button>
                                            
                                            <button id="btn-formatear-db">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>
                                                Formatear Todo
                                            </button>
                                        </div>
                                        <input type="file" id="import-file-input" accept=".json, .xlsx, .xls" style="display: none;">
                                        <span id="mensaje-import-export"></span>
                                    </div>
                                    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
                                    <!-- Contenedor para Crear Usuarios -->
                                    <div id="crear-usuario-container">
                                        <h2>Crear Nuevo Usuario</h2>
                                        <form id="crear-usuario-form">
                                            <div class="input-group">
                                                <label for="new-username">Nombre de Usuario:</label>
                                                <input type="text" id="new-username" name="new-username" required>
                                            </div>
                                            <div class="input-group">
                                                <label for="new-password">Contrase√±a:</label>
                                                <input type="password" id="new-password" name="new-password" required>
                                            </div>
                                            <div class="input-group">
                                                <label for="confirm-password">Confirmar Contrase√±a:</label>
                                                <input type="password" id="confirm-password" name="confirm-password" required>
                                            </div>
                                            <button type="submit" id="boton-crear-usuario"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z"/></svg> Crear Usuario</button>
                                            <div id="mensaje-crear-usuario" class="error-message" role="alert" aria-live="polite"></div>
                                        </form>
                                    </div>
                        
                                    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
                        
                                    <!-- Nuevo Contenedor para Control de Usuarios -->
                                    <div id="user-management-container">
                                        <h2>Control de Usuarios Existentes</h2>
                                        <div class="user-list-header">
                                            <span>Usuario</span>
                                            <span>Activo</span>
                                            <span>Censo</span>
                                            <span>Corrientes</span>
                                            <span>Lecturas</span>
                                            <span>Configuraci√≥n</span>
                                        </div>
                                        <div id="users-list">
                                            <!-- Los usuarios se cargar√°n aqu√≠ din√°micamente -->
                                        </div>
                                        <div id="mensaje-gestion-usuarios" style="margin-top: 15px; font-weight: bold;" aria-live="polite"></div>
                                    </div>
                        
                                </div>
    </div>

    <!-- Modal de confirmaci√≥n (usado por Facturaci√≥n para consumos altos) -->
    <div id="confirm-modal" class="confirm-modal" style="display:none;">
        <div class="confirm-modal__card">
          <p id="confirm-modal-message"></p>
          <div class="confirm-modal__actions">
            <button id="confirm-modal-accept" class="btn-primary">Continuar</button>
            <button id="confirm-modal-cancel" class="btn-secondary">Cancelar</button>
          </div>
        </div>
    </div>

    <!-- Modal de Administraci√≥n de Artefactos -->
    <div id="modal-artefactos" class="modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modal-artefactos-titulo">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close" aria-label="Cerrar">&times;</button>
            <h2 id="modal-artefactos-titulo">Administraci√≥n de Artefactos</h2>
            <div class="artefactos-container">
                <!-- Formulario de Artefactos -->
                <div class="artefactos-form">
                    <form id="form-artefactos">
                        <input type="hidden" id="artefactoId">
                        <div class="form-grid">
                                        <div class="form-group">
                                            <label for="txtAparatos">Aparato:</label>
                                            <input type="text" id="txtAparatos" required>
                                            <span class="error-msg"></span>
                                        </div>
                                        <div class="form-group">
                                            <label for="numWatt">Watt (W):</label>
                                            <input type="number" id="numWatt" min="0" step="0.01" required>
                                            <span class="error-msg"></span>
                                        </div>
                                        <div class="form-group">
                                            <label for="numFP">Factor de Potencia (FP):</label>
                                            <input type="number" id="numFP" min="0.1" max="1" step="0.01" value="0.85">
                                            <span class="error-msg"></span>
                                        </div>
                                        <div class="form-group">
                                            <label for="numHD">Horas/D√≠a (H/D):</label>
                                            <input type="number" id="numHD" min="0" max="24" step="0.1" value="1">
                                            <span class="error-msg"></span>
                                        </div>
                                        <div class="form-group">
                                            <label for="selFase">Fase:</label>
                                            <select id="selFase">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                                                    <label for="numVoltaje">Voltaje (V):</label>
                                                                    <select id="numVoltaje">
                                                                        <option value="115">115</option>
                                                                        <option value="220">220</option>
                                                                    </select>
                                            <span class="error-msg"></span>
                                        </div>
                                    </div>
                                    <div class="form-buttons">
                                        <button type="button" id="btn-guardar-artefacto">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path fill-rule="evenodd" d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg>
                                            Guardar
                                        </button>
                                        
                                        <button type="button" id="btn-nuevo-artefacto">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                                            Nuevo
                                        </button>
                    
                                        <button type="button" id="btn-formatear-artefactos" class="btn-warning">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.5 5.5A.5.5 0 0 1 8 6v1.5H9.5a.5.5 0 0 1 0 1H8V10a.5.5 0 0 1-1 0V8.5H5.5a.5.5 0 0 1 0-1H7V6a.5.5 0 0 1 .5-.5z"/><path d="m11.25 8.5.83.83a2.5 2.5 0 0 1 0 3.53l-.02.02a2.5 2.5 0 0 1-3.54 0l-.83-.83a.5.5 0 1 1 .71-.71l.83.83a1.5 1.5 0 0 0 2.12 0l.02-.02a1.5 1.5 0 0 0 0-2.12l-.83-.83a.5.5 0 0 1 .71-.71zM1 13.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm10-10a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zM3.5 1a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5z"/></svg>
                                            Varita
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Tabla de Artefactos -->
                            <div class="artefactos-tabla-container">
                                <div class="search-container">
                                    <input type="text" id="filtro-artefactos" placeholder="üîç Buscar artefacto..." class="search-input">
                                </div>
                                <table id="tabla-artefactos">
                                    <thead>
                                        <tr>
                                            <th>Aparato</th>
                                            <th>Watt</th>
                                            <th>FP</th>
                                            <th>H/D</th>
                                            <th>Fase</th>
                                            <th>Voltaje</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Filas se insertar√°n din√°micamente -->
                                    </tbody>
                                </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ========= BARRA DE NAVEGACI√ìN M√ìVIL ========= -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-pestana="consumo">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-clipboard-data" viewBox="0 0 16 16">
                <path d="M4 11a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0v-1zm6-4a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0V7zM7 9a1 1 0 0 1 2 0v3a1 1 0 1 1-2 0V9z"/>
                <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3z"/>
            </svg>
            Censo
        </button>

        <button class="nav-item" data-pestana="corrientes">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-lightning-charge" viewBox="0 0 16 16">
                <path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/>
            </svg>
            Medici√≥n
        </button>

        <button class="nav-item" data-pestana="lecturas">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-speedometer2" viewBox="0 0 16 16">
                <path d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.5.5 0 0 1 0 .708l-.914.915a.5.5 0 1 1-.708-.708l.915-.914a.5.5 0 0 1 .707 0zM12 10a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-1 0v-1.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M8 16a6 6 0 1 0 0-12 6 6 0 0 0 0 12zM6.354 5.646a.5.5 0 1 1 .708-.708l2.146 2.147a.5.5 0 0 1-.707.708L6.354 5.646z"/>
            </svg>
            Lecturas
        </button>

        <button class="nav-item" data-pestana="configuracion">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311a1.464 1.464 0 0 1-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413-1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311-.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
            </svg>
            Config
        </button>
    </nav>

    <!-- Scripts -->
    <script src="Scripts/common.js?v=2.2"></script>
    <script src="Scripts/login.js?v=2"></script>
    <script src="Scripts/artefactos.js?v=2"></script>
    <script src="Scripts/consumo.js?v=2"></script>
    <script src="Scripts/corrientes.js?v=2"></script>
    <script src="Scripts/lecturas.js?v=2"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registrado:', reg.scope))
                    .catch(err => console.log('Fallo SW:', err));
            });
        }
    </script>
</body>
</html>
                        
                        